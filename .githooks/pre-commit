#!/usr/bin/env bash
set -euo pipefail

if ! command -v swift-format >/dev/null 2>&1; then
  echo "swift-format is not installed or not on PATH." >&2
  exit 1
fi

repo_root="$(git rev-parse --show-toplevel)"
cd "$repo_root"

swift_files=()
while IFS= read -r -d '' file; do
  swift_files+=("$file")
done < <(git diff --cached --name-only --diff-filter=ACMR -z -- '*.swift')

echo "Checking ${#swift_files[@]} staged Swift files with swift-format..."

if [ ${#swift_files[@]} -eq 0 ]; then
  exit 0
fi

echo "swift-format: linting staged Swift files..."
swift-format lint --strict "${swift_files[@]}"
